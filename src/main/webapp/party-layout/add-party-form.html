<!DOCTYPE html>
<html lang="ko" 
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
   <title>애플리케이션</title>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <link rel="stylesheet" type="text/css" href="css/reset.css">
   <link rel="stylesheet" type="text/css" href="css/add-party-form.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" integrity="sha512-cyzxRvewl+FOKTtpBzYjW6x6IAYUCZy3sGP40hn+DQkqeluGRCax7qztK2ImL64SA+C7kVWdLI6wvdlStawhyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js" integrity="sha512-6lplKUSl86rUVprDIjiW8DuOniNX8UDoRATqZSds/7t6zCQZfaCe3e5zcGaQwxa8Kpn5RTM9Fvl3X2lLV4grPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   
</head>
<style>

</style>
<body>
<c:set var="menu" value="직원" />
<div class="container">
	<div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header" style="background-color: rgb(237, 246, 255);"">
                    <h5>파티 정보를 입력하고 개설해보세요.</h5>
                </div>			
                <form action="">
                    <div class="card-body">
                        <div class="form-group mb-3 col-12">
                            <label class="form-label">파티명</label>
                            <input type="text" class="form-control form-control-lg" placeholder="파티 이름을 입력해주세요.">
                        </div>
                        <!-- 파티 이미지 선택 구간 -->
                        <div class="row">
                            <div id="coverSelect" class="form-group mb-3 row">
                                <!-- 메인 커버 - 고른 사진 미리보여주는 곳 -->
                                <div id="mainCover" class="col-6 mainCover-container">
                                    <div id="result-container" class="col-12" style="margin: auto;">
                                        <img id="preview" src="" alt="이미지미리보기">
                                        <div id="result"></div>
                                    </div>
                                </div>
                            
                                <!-- 사진을 로컬에서 고르거나 기본 이미지를 고르는 곳 -->
                                <div id="coverlist" class="col-6 coverList-container">
                                    <div class="coverlist-text">
                                        <p class="text-muted">기본 커버를 선택하거나 추가하세요</p>
                                    </div>
                                    <div class="coverlist-images">
                                        <div class="">
                                            <span id="addPhotoSpan">
                                                <img class="rounded" src="사진추가.png" id="avatar" alt="avatar">
                                                <input type="file"  class="sr-only" id="input" name="image" accept="image/*" style="display: none;">
                                            </span>
                                        </div>
                                        <div class="">
                                            <img src="샘플1.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플2.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플3.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플3.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플2.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플1.jpg" alt="">
                                        </div>
                                        <div class="">
                                            <img src="샘플2.jpg" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-muted">파티명과 사진은 개설 후에도 변경할 수 있어요</p>
                        </div>
                    
                        <div class="row">
                            <!-- 카테고리 선택 -->
                            <div class="mb-3 col-6">
                                <label class="form-label">파티</label>
                                <select class="form-select category-select">
                                    <option selected disabled > 카테고리를 고르세요.</option>
                                    <option value="" > 취미/동호회</option>
                                    <option value=""> 가족</option>
                                    <option value="" > 스터디</option>
                                    <option value="" > 학교, 동아리</option>
                                    <option value="" > 운동 모임</option>
                                </select>
                            </div>
                            
                            <!-- 최대 정원 -->
                            <div class="mb-3 col-6">
                                <label class="form-label">최대정원</label>
                                <input class="form-control" type="number" placeholder="최대 1000명" >
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- 가입조건 -->
                            <div class="mb-3 col-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">가입조건</label>
                                    <div class="form-check form-switch" id="req-group">
                                        <div class="row" id="req">
                                            <div class="col">
                                                <div class="row mb-3">
                                                    <label class="col-4 col-form-label" for="birthStart">최소나이</label>
                                                    <select class="col-8 age-select form-select" name="birthStart">
                                                        <option value="9999" selected>제한없음</option>
                                                        <option value="1997"> 1997년생 (만 26세)</option>
                                                        <option value="1998"> 1998년생 (만 25세)</option>
                                                        <option value="1999"> 1999년생 (만 24세)</option>
                                                        <option value="2000"> 2000년생 (만 23세)</option>
                                                    </select>
                                                </div>
                                                <div class="row">
                                                    <label class="col-4 col-form-label" for="birthEnd">최대나이</label>
                                                    <select class="col-8 age-select form-select" name="birthEnd">
                                                        <option value="9999" selected>제한없음</option>
                                                        <option value="1997"> 1997년생 (만 26세)</option>
                                                        <option value="1998"> 1998년생 (만 25세)</option>
                                                        <option value="1999"> 1999년생 (만 24세)</option>
                                                        <option value="2000"> 2000년생 (만 23세)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="row">
                                                    <label class="col-3 col-form-label" for="gender">성별</label>
                                                    <select class="form-select age-select" name="gender" id="gender">
                                                        <option value="A" selected>제한없음</option>
                                                        <option value="M">남</option>
                                                        <option value="F">여</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 파티설명 -->
                            <div class="mb-3 col-6">
                                <label for="" class="form-label">파티설명</label>
                                <textarea name="" id="" cols="30" rows="4" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer" style="background-color:  rgb(237, 246, 255)" >
                        <div class="text-end">
                            <button id="btn" class="btn btn-primary">파티생성</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- 사진 자르기 모달 출력 부분 -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalLabel">Crop the image</h5>
            </div>
            <div class="modal-body">
              <div class="img-container">
                <img id="image" src="">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="cropbutton">Crop</button>
            </div>
          </div>
        </div>
      </div>
</div>
<script type="text/javascript">
    $(function() {
        let randomImageIndex = Math.floor(Math.random() * 7) + 1;
        // 페이지 로딩 완료 후 실행 로드 되자마자 랜덤 이미지를 선택하게 함
        let defaultImageSrc = $("#coverlist img:eq("+randomImageIndex+")").attr('src');  // coverlist 내의 랜덤index에 해당하는 이미지를 가져옴
        $('#mainCover img').attr('src', defaultImageSrc);  // mainCover의 img 태그의 src에 랜덤으로 선택된 이미지의 src를 설정
        

        // 사용자가 사이트에서 기본으로 제공되는 이미지를 클릭했을 때의 스크립트
	    $("#coverlist img:not(#addPhotoSpan img)").click(function() {
            // 마우스포인터가 옮겨가 썸네일 이미지 엘리먼트의 src 속성값을 조회한다.
            let imagepath = $(this).attr("src");
            // 위에서 조회한 이미지 경로를 큰 이미지로 표현하는 src의 속성값으로 지정한다.
            $("#mainCover img").attr("src", imagepath);

            // preview를 보이게 하고, result를 숨긴다.
            $("#preview").show();
            $("#result").hide();
	    })

        // 사용자가 사진추가 이미지를 눌러 로컬에서 이미지를 선택할 수 있게 하는 스크립트
        $('#addPhotoSpan img').on('click', function() {
            $('#input').click();
        });

      var avatar = document.getElementById('avatar');
      var $image = $("#image");
      var $input = $("#input");
      var $result = $("#result");
      var $cropbutton = $("#cropbutton");

      var $progress = $('.progress');
      var $progressBar = $('.progress-bar');
      var $alert = $('.alert');
      var $modal = $('#modal');
      var cropper;


      $('[data-toggle="tooltip"]').tooltip();

      $input.on('change', function (e) {
          var files = e.target.files;
          console.log(files);
          var done = function (url) {
            console.log(url)
          $input.val("");
          $image.attr("src", url);
          $alert.hide();
          $modal.modal('show');
        };
        var reader;
        var file;
        var url;

        if (files && files.length > 0) {
          file = files[0];

          if (URL) {
            done(URL.createObjectURL(file));
          } else if (FileReader) {
            reader = new FileReader();
            reader.onload = function (e) {
              done(reader.result);
            };
            reader.readAsDataURL(file);
          }
        }
      });

      $modal.on('shown.bs.modal', function () {
        cropper = new Cropper(image, {
          aspectRatio: 5/4,
          viewMode: 3,
          minContainerHeight: 600,
          zoomable: false,
          cropBoxResizable: false,
          dragMode: 'move',

          data: {
            width: 300,
            height: 250,
          },
        });
        
        $cropbutton.on("click", function() {
            $result.html('');
            $result.append(cropper.getCroppedCanvas());
            $modal.modal('hide');
            // result를 보이게 하고, preview를 숨긴다.
            $("#result").show();
            $("#preview").hide();
        })

       
        
      }).on('hidden.bs.modal', function () {
        cropper.destroy();
        cropper = null;
      });

    })
</script>
</body>
</html>